clusterName: observability-logs

nodeSets:
  - name: hot
    count: 6
    config:
      node.roles: ["master", "data_hot", "ingest"]
      node.attr.availability_zone: zone-a
      cluster.routing.allocation.awareness.attributes: availability_zone
    podTemplate:
      metadata:
        labels:
          topology.kubernetes.io/zone: zone-a
      spec:
        containers:
          - name: elasticsearch
            resources:
              requests:
                cpu: 2000m
                memory: 8Gi
              limits:
                cpu: 4000m
                memory: 16Gi
            env:
              - name: ES_JAVA_OPTS
                value: "-Xms8g -Xmx8g"
    volumeClaimTemplates:
      - metadata:
          name: elasticsearch-data
        spec:
          accessModes: ["ReadWriteOnce"]
          storageClassName: fast-ssd
          resources:
            requests:
              storage: 2Ti
  - name: warm
    count: 3
    config:
      node.roles: ["data_warm"]
      node.attr.availability_zone: zone-b
      cluster.routing.allocation.awareness.attributes: availability_zone
    podTemplate:
      metadata:
        labels:
          topology.kubernetes.io/zone: zone-b
      spec:
        containers:
          - name: elasticsearch
            resources:
              requests:
                cpu: 1000m
                memory: 4Gi
              limits:
                cpu: 2000m
                memory: 8Gi
            env:
              - name: ES_JAVA_OPTS
                value: "-Xms4g -Xmx4g"
    volumeClaimTemplates:
      - metadata:
          name: elasticsearch-data
        spec:
          accessModes: ["ReadWriteOnce"]
          storageClassName: standard-hdd
          resources:
            requests:
              storage: 4Ti

esConfig:
  elasticsearch.yml: |
    action.destructive_requires_name: true
    cluster.max_shards_per_node: 200
    cluster.routing.allocation.balance.shard: 0.55
    cluster.routing.allocation.balance.index: 0.45
    indices.recovery.max_bytes_per_sec: 200mb
    xpack.security.enabled: true

service:
  type: ClusterIP

http:
  service:
    type: ClusterIP

updateStrategy:
  type: RollingUpdate

indexLifecyclePolicies:
  card-logs-policy:
    policy:
      phases:
        hot:
          actions:
            rollover:
              max_primary_shard_size: 50gb
              max_age: 7d
        warm:
          min_age: 7d
          actions:
            set_priority:
              priority: 50
            allocate:
              number_of_replicas: 1
              include:
                _tier_preference: data_warm,data_cold
        delete:
          min_age: 30d
          actions:
            delete: {}

indexTemplates:
  card-logs-template:
    index_patterns:
      - logs-card-production-*
    priority: 500
    data_stream: {}
    template:
      settings:
        index.lifecycle.name: card-logs-policy
        index.lifecycle.rollover_alias: logs-card-production
        index.routing.allocation.include._tier_preference: data_hot,data_warm
        number_of_shards: 3
        number_of_replicas: 1
      mappings:
        dynamic: true